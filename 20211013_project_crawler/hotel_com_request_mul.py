import time
import requests
import json
from env import param
from pymongo import MongoClient
import concurrent.futures
from env import config

###date generator
from datetime import date, timedelta

def daterange(start_date, end_date):
    for n in range(int((end_date - start_date).days)):
        yield start_date + timedelta(n)
####

conn = MongoClient("mongodb://root:{}@ec2-3-145-1-7.us-east-2.compute.amazonaws.com:27017/?authSource=admin&readPreference=primary&appname=MongoDB%20Compass&directConnection=true&ssl=false".format(config.MONGO_PASS_SKIKE_EC2))
mydatabase = conn['skike'] 
# Access collection of the database 
mycollection=mydatabase['skike_hotel']

def gettotalHotel(id,value,type,shortName,page,date1,date2):
    url = "https://tw.hotels.com/kes/graphql"

    payload = json.dumps({
    "operationName": "searchPageQuery",
    "variables": {
        "sqmState": {
        "destination": {
            "id": "{}".format(id),
            "value": "{}".format(value),
            "type": "{}".format(type),
            "shortName": "{}".format(shortName)
        },
        "checkIn": "{}".format(date1),
        "checkOut": "{}".format(date2),
        "rooms": 1,
        "adults": {
            "0": 1
        },
        "kids": {
            "0": []
        }
        },
        "filterState": {
        "accessibility": [],
        "accommodationType": [],
        "amenities": [],
        "applied": False,
        "brands": [],
        "facilities": [],
        "guestRating": {
            "min": None,
            "max": None
        },
        "landmarks": [],
        "name": {
            "id": None,
            "value": ""
        },
        "neighbourhood": [],
        "paymentPreference": [],
        "popular": [],
        "price": {
            "min": None,
            "max": None,
            "multiplier": 1,
            "defaultMax": 25000
        },
        "sortLandmarkId": "",
        "sortOrder": "BEST_SELLER",
        "starRating": [],
        "themesAndTypes": [],
        "types": [],
        "vrFilterClicked": False,
        "welcomeRewards": []
        },
        "pageName": "srp",
        "points": False,
        "pagination": {
        "pn": page,
        "pg": 1,
        "startIndex": 0
        }
    },
    "query": "fragment FilterRangeFragment on FilterRange {\n  min {\n    value\n    defaultValue\n    __typename\n  }\n  max {\n    value\n    defaultValue\n    __typename\n  }\n  increments\n  __typename\n}\n\nfragment FilterWithItemsFragment on FilterWithItems {\n  label\n  applied\n  items {\n    label\n    value\n    applied\n    disabled\n    mappedIds\n    requestParameterName\n    filterCategory\n    minValue\n    maxValue\n    __typename\n  }\n  __typename\n}\n\nquery searchPageQuery($sqmState: SqmState!, $filterState: FilterState, $pagination: SearchPaginationState, $pageName: String, $points: Boolean) {\n  searchPage(\n    sqmState: $sqmState\n    pagination: $pagination\n    filterState: $filterState\n    points: $points\n  ) {\n    id\n    page {\n      ...PageFragment\n      __typename\n    }\n    header {\n      ...HeaderFragment\n      __typename\n    }\n    chassis {\n      ...ChassisFragment\n      __typename\n    }\n    body {\n      ... on SrpBodyError {\n        error {\n          message\n          __typename\n        }\n        __typename\n      }\n      ... on SrpBodySuccess {\n        target\n        searchResults {\n          totalCount\n          narrowResultsText\n          travelAdsAvailableOnSortedSearch\n          pagination {\n            currentPage\n            nextPageUrl\n            __typename\n          }\n          algoGeoBulletsTracking\n          results {\n            ...SearchHotelResultFragment\n            __typename\n          }\n          unavailableCount\n          brandMultiPropertyCarouselResult {\n            ...BrandMultiPropertyCarouselResultFragment\n            __typename\n          }\n          __typename\n        }\n        sortResults {\n          defaultSortApplied\n          distanceOptionLandmarkId\n          sortLandmarkId\n          options {\n            label\n            selectedChoiceLabel\n            choices {\n              label\n              value\n              href\n              selected\n              __typename\n            }\n            enhancedChoices {\n              label\n              choices {\n                label\n                id\n                __typename\n              }\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        filters {\n          applied\n          name {\n            disabled\n            item {\n              hotelId\n              value\n              __typename\n            }\n            __typename\n          }\n          popular {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          price {\n            disabled\n            label\n            range {\n              ...FilterRangeFragment\n              __typename\n            }\n            multiplier\n            __typename\n          }\n          guestRating {\n            disabled\n            applied\n            range {\n              ...FilterRangeFragment\n              __typename\n            }\n            __typename\n          }\n          starRating {\n            label\n            applied\n            items {\n              label\n              value\n              applied\n              disabled\n              mappedIds\n              requestParameterName\n              filterCategory\n              minValue\n              maxValue\n              __typename\n            }\n            __typename\n          }\n          paymentPreference {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          welcomeRewards {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          neighbourhood {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          landmarks {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          accommodationType {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          facilities {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          themesAndTypes {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          accessibility {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          __typename\n        }\n        pointOfSale {\n          currency {\n            separators\n            format\n            __typename\n          }\n          __typename\n        }\n        loyalty {\n          ...LoyaltyFragment\n          __typename\n        }\n        miscellaneous {\n          disclaimer\n          fullSccFormat\n          pageViewBeaconUrl\n          showSortDisclaimer\n          interactiveSortDisclaimer\n          sortDisclaimer\n          compressionMessaging {\n            percentage\n            popularityMessage\n            __typename\n          }\n          rewardBanner {\n            autoOpen\n            type\n            punchCard {\n              collectedNights\n              reservedNights\n              freeNights\n              closeToEarn\n              punchCardMessage\n              __typename\n            }\n            __typename\n          }\n          isAutoPopulatedDate\n          ads {\n            es5LibraryUrl\n            adsLoaderUrl\n            adsPositions\n            nativeBrandListingPosition\n            pageId\n            targetingConfig {\n              mc1\n              CMPTST\n              d\n              ssl\n              kid\n              dta\n              ets\n              ete\n              pd\n              __typename\n            }\n            __typename\n          }\n          showMetaOccupancyNotification\n          travelAdvisoryBannerMessaging {\n            title\n            message\n            links {\n              text\n              url\n              __typename\n            }\n            __typename\n          }\n          freeCancellationBannerMessaging {\n            head\n            description\n            __typename\n          }\n          noCreditCardFilterReportable\n          payPalFilterReportable\n          kesAppDownloadMessaging {\n            ...AppDownloadMessagingFragment\n            __typename\n          }\n          __typename\n        }\n        packageRates {\n          message\n          packageRateIcon\n          __typename\n        }\n        alternativeDestinationsModule {\n          ...AlternativeDestinationFragment\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    footer {\n      ...FooterFragment\n      redemptionFee {\n        link {\n          label\n          href\n          rel\n          target\n          __typename\n        }\n        message\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment PageFragment on Page {\n  head {\n    linkedData\n    __typename\n  }\n  __typename\n}\n\nfragment NavigationLinkFragment on NavigationLink {\n  label\n  linkId\n  url\n  icon\n  rel\n  class\n  number\n  children {\n    kes_icon\n    label\n    linkId\n    class\n    url\n    icon\n    rel\n    number\n    __typename\n  }\n  __typename\n}\n\nfragment HeaderFragment on Header {\n  id\n  tracking {\n    consentGiven\n    callCcaOnInit\n    showBanner\n    __typename\n  }\n  pos {\n    label\n    __typename\n  }\n  navigationLinks {\n    top {\n      ...NavigationLinkFragment\n      __typename\n    }\n    topAlt {\n      ...NavigationLinkFragment\n      __typename\n    }\n    bottom {\n      ...NavigationLinkFragment\n      __typename\n    }\n    bottomAlt {\n      ...NavigationLinkFragment\n      __typename\n    }\n    __typename\n  }\n  userPrivacyPreferences {\n    dnsmpi\n    __typename\n  }\n  user {\n    is_identified\n    is_logged_in\n    hcom_rewards_tier\n    channel\n    __typename\n  }\n  newsletterSignUpAnywhere {\n    nativeApplicationDownloadUrl\n    privacyPolicyLink\n    termsAndConditionsLink\n    proxyUrl\n    targetOrigin\n    __typename\n  }\n  config {\n    targetUrl\n    __typename\n  }\n  context {\n    includeCurrencyOption\n    flagIso\n    currencyLabel\n    __typename\n  }\n  cobrand\n  headerConfig {\n    logoPosition\n    orderFlipped\n    sameColors\n    mobileMenuPosition\n    __typename\n  }\n  poweredBy\n  __typename\n}\n\nfragment ChassisFragment on Chassis {\n  id\n  page {\n    pageTitle\n    metas\n    links\n    cdb\n    mdl\n    omniture\n    __typename\n  }\n  user {\n    firstName\n    consent {\n      callCcaOnInit\n      consentGiven\n      showBanner\n      dnsmpi\n      __typename\n    }\n    favourites\n    __typename\n  }\n  tracking {\n    harvesterUrl\n    travelPixelEnv\n    tagCommanderUrl\n    googleTagManagerId\n    omnitureAccount\n    __typename\n  }\n  mainImage {\n    href\n    focus\n    enabled\n    __typename\n  }\n  appContext {\n    pos\n    channel\n    platform\n    currency\n    locale\n    brandId\n    langdir\n    isKnownUser\n    clientId\n    clientVersion\n    authenticationState\n    guid\n    customerId\n    subscriber\n    __typename\n  }\n  srs {\n    suggest\n    resolve\n    recommend\n    commonParams {\n      providerInfoTypes\n      locale\n      __typename\n    }\n    __typename\n  }\n  sqm {\n    destination {\n      id\n      value\n      type\n      resolvedLocation {\n        name\n        latitude\n        longitude\n        __typename\n      }\n      shortName\n      latitude\n      longitude\n      __typename\n    }\n    toSRPdestination {\n      id\n      value\n      type\n      __typename\n    }\n    title\n    checkIn\n    checkOut\n    rooms\n    firstDayOfWeek\n    adults\n    kids\n    isVisible\n    __typename\n  }\n  filter {\n    accessibility\n    accommodationType\n    amenities\n    applied\n    brands\n    facilities\n    guestRating {\n      min\n      max\n      __typename\n    }\n    landmarks\n    name {\n      id\n      value\n      __typename\n    }\n    neighbourhood\n    paymentPreference\n    popular\n    price {\n      min\n      max\n      multiplier\n      defaultMax\n      __typename\n    }\n    sortLandmarkId\n    sortOrder\n    starRating\n    themesAndTypes\n    types\n    vrFilterClicked\n    welcomeRewards\n    __typename\n  }\n  navigation {\n    pathname\n    rateplanId\n    search\n    sbgState {\n      rooms\n      kids\n      adults\n      __typename\n    }\n    points\n    __typename\n  }\n  __typename\n}\n\nfragment FooterFragment on Footer {\n  id(id: $pageName)\n  links {\n    label\n    href\n    children {\n      label\n      href\n      rel\n      target\n      item_meta {\n        id\n        class\n        __typename\n      }\n      __typename\n    }\n    rel\n    target\n    sub_label\n    item_meta {\n      id\n      class\n      __typename\n    }\n    __typename\n  }\n  copyright\n  loyaltyProgramLink {\n    label\n    href\n    rel\n    target\n    __typename\n  }\n  trustMessage\n  legallyCompliantPricesMessage\n  __typename\n}\n\nfragment SearchHotelResultFragment on SearchResult {\n  hotelId\n  imageId\n  hostType\n  addNoFollow\n  searchHotelDetails {\n    ...SearchHotelDetailsFragment\n    __typename\n  }\n  pinned {\n    info\n    reason\n    isStopSell\n    reasonCode\n    __typename\n  }\n  sponsored {\n    impressionTrackingUrl\n    clickTrackingUrl\n    travelAdDetails\n    travelAdDetailsHeadLine\n    travelAdHotelImage\n    __typename\n  }\n  coupon\n  deal {\n    ...DealFragment\n    __typename\n  }\n  neighbourhood\n  geoBullets\n  propertyType\n  popularAmenities {\n    type\n    description\n    __typename\n  }\n  altText\n  ratePlan {\n    price {\n      ...SearchResultRatePlanPriceFragment\n      __typename\n    }\n    features {\n      instalmentsMessage\n      noCCRequired\n      freeCancellation\n      payAtPropertyBadge\n      __typename\n    }\n    __typename\n  }\n  coordinate {\n    lat\n    lon\n    __typename\n  }\n  roomsLeft\n  soldOut\n  dealOfTheDay\n  isInExpandedArea\n  badging {\n    hotelBadge {\n      type\n      label\n      loyaltyTier\n      tooltipTitle\n      tooltipText\n      percentile\n      __typename\n    }\n    secretPriceBadge\n    __typename\n  }\n  couponBadge {\n    badgeName\n    tooltip\n    badgeText\n    linkText\n    linkPath\n    __typename\n  }\n  vip\n  urls {\n    alternativeOccupancy {\n      adults\n      kids\n      __typename\n    }\n    __typename\n  }\n  rlsa\n  isGreatMatch\n  imageTrackingInfo\n  hotelMessage\n  vitality\n  bedTypeOccupancy\n  isVrboProperty\n  __typename\n}\n\nfragment SearchHotelDetailsFragment on SearchHotelDetails {\n  id\n  name\n  vrBadge\n  optimizedThumbUrl\n  optimizedCompactThumbUrl\n  optimizedImages {\n    imageUrl\n    title\n    __typename\n  }\n  address {\n    countryName\n    locality\n    postalCode\n    region\n    streetAddress\n    obfuscate\n    __typename\n  }\n  fullAddress\n  locationCoordinates {\n    latitude\n    longitude\n    __typename\n  }\n  starRating\n  guestReviews {\n    rating\n    lowRating\n    badgeText\n    total\n    __typename\n  }\n  welcomeRewards {\n    tooltipText\n    collect\n    redeem\n    __typename\n  }\n  selectButtonText\n  __typename\n}\n\nfragment SearchResultRatePlanPriceFragment on SearchResultRatePlanPrice {\n  current\n  secondaryFormatted\n  exactCurrent\n  old\n  info\n  summary\n  fromPrice\n  supplierCollectedCharges\n  totalPricePerStay\n  fullyBundledPricePerStay\n  roomCount\n  priceBreakdown {\n    title\n    callToActionLabel\n    includedMeals {\n      label\n      type\n      __typename\n    }\n    lineItems {\n      label\n      feeDetails\n      price\n      __typename\n    }\n    total {\n      label\n      price\n      __typename\n    }\n    additionalFees {\n      label\n      price\n      __typename\n    }\n    totalIncludingAdditionalFees {\n      label\n      price\n      __typename\n    }\n    ecaMessage\n    __typename\n  }\n  __typename\n}\n\nfragment DealFragment on Deal {\n  text\n  type\n  purpose\n  discountPercent\n  translation\n  packageRateIcon\n  __typename\n}\n\nfragment BrandMultiPropertyCarouselResultFragment on BrandMultiPropertyCarouselResult {\n  brandAdCopy\n  brandLogo\n  position\n  title\n  seeAllPropertiesURLText\n  brandIds\n  properties {\n    ...SearchHotelResultFragment\n    __typename\n  }\n  __typename\n}\n\nfragment AlternativeDestinationFragment on AlternativeDestinationList {\n  category\n  key\n  title\n  egRecsResponseData {\n    responseId\n    success\n    __typename\n  }\n  cards {\n    gaiaId\n    destinationId\n    propertyTypeName\n    image {\n      src\n      alt\n      author {\n        name\n        url\n        origin\n        license {\n          suite\n          url\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    title\n    description\n    popUpSqmTitle\n    filters {\n      accommodationType\n      amenities\n      starRating\n      types\n      themesAndTypes\n      __typename\n    }\n    link\n    __typename\n  }\n  __typename\n}\n\nfragment AppDownloadMessagingFragment on KesAppDownloadMessagingModular {\n  downloadAppUrl\n  enabled\n  id\n  category\n  key\n  heading\n  body\n  __typename\n}\n\nfragment LoyaltyFragment on Loyalty {\n  pointsToggle {\n    pointsName\n    enabled\n    infoMessage\n    airMilesChecked\n    __typename\n  }\n  banner {\n    message\n    sidebarMessage\n    __typename\n  }\n  __typename\n}\n"
    })
    headers = {
    'cookie': 'bm_sz=2B1DF69BCA48BC1620711995E65EE276~YAAQbNfSF23mBlR8AQAA9kpwog3nFvZwgsy83GFCQGHCQtH7l5SfETSrdsz+MSiVk0Zoj6lKSATyxlXOHqHAklbTDeoTJqugzaZH9K+MHcFGUW35hTtiJ3y+L6O67o9oAmzDRVRMrA0+Ex6fuAndplIQSBB91oKPcUftm+SbCXMiD/M+F0EUOym0U8mNHqGcS/A8E8GDJqVHgDS1D3OoCHROayD+qJ2/e6xMpVQHlE+u46e1hDT7cuhFmFMo2OTTZPvmbr8J64BzyGcLYKQMmMeEkOjMmcnbSsebc7nt0iax3Z8=~3749173~3224625; aws=1; asc=1; visitId=289c99ff-459d-4a35-a937-bc14e700b32f; SESSID=9fo7pEVg9Ihdbeg4z-vsz08iA7.hpa-5484d594bb-j8k8k; user=QSp6aF9UV3xIQ09NX1RX; guid=44b54c97-755f-4974-ba60-76eae9d5559d; MC1=GUID=44b54c97755f4974ba6076eae9d5559d; DUAID=44b54c97-755f-4974-ba60-76eae9d5559d; mvthistory=eJwtzTEOgDAMQ9EbVUmcNmlWFhbEgsTIzB04PJB2e%2FqyZHaphQoFu3GRj7cFd20ZhbyPiBA4hjmk9jlo0MIZKSBmWZW5TjRMGI0dQkG%2F8kkrZHQN7Z7jZ1327TrOF8SNIQ8%3D; dr=CCC~1634812845~62AB874DF01AE5275749371BE36C0408696F14285765523964F5A31B2EDDA8A8; akacd_pr_20=1639996846~rv=28~id=1984c7207359e5e958fb981f371f092d; _abck=4818A14A6F097D98C5669D785DC18DDA~0~YAAQbNfSF3rmBlR8AQAAXmdwogbQXLqaiW0p3R/NkhxCU3eh0hDv5yL785qlEitqK6jrKWhWpAD+EsykFlZuu0qyCK/8qIOeAW1rrXEEmhiQUN/jpzOy3KBy/3Ngeb3ZX9kV5ehnAjTmKPSiOcDMTlSXQp/SdDyXaL+1x+pSUOWJb0oVaSKCzX5SRsfyqo430RxeIVTfg/EwxxV7SfTJftCblLN04rlFu1EVxc3O6DlK6YM5BbAWMfWjWij6rPaLQS4swocLwWOxqincPAKgz1du0RdpEATn3uRYpeu2AANcBZrHkEh95dmPw6t7c49CpQmvBkU0O1GMuXKNyZYE+N89BBfYQZHGCioDQFDldmvpUm/mUkMRbKz8WWySyIEhlgLWqPkBFftfWuD79Bm+nTjKoBa9yMTD~-1~-1~-1; AMCVS_C00802BE5330A8350A490D4C%40AdobeOrg=1; s_ecid=MCMID%7C34822611654359650602901547180939099068; AMCV_C00802BE5330A8350A490D4C%40AdobeOrg=-1330315163%7CMCIDTS%7C18922%7CMCMID%7C34822611654359650602901547180939099068%7CMCAAMLH-1635417648%7C11%7CMCAAMB-1635417648%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1634820048s%7CNONE%7CMCAID%7CNONE; s_cc=true; xdid=138f2060-8f5b-42fc-b311-695ebaf2531d|1634191302|expedia.com.tw; xdidp=138f2060-8f5b-42fc-b311-695ebaf2531d|1634191302|expedia.com.tw; Session_Pageviews=1; _ga=GA1.2.1890440273.1634812852; _gid=GA1.2.375059388.1634812852; _gat_gtag_UA_32616238_1=1; _gcl_au=1.1.1705634850.1634812852; _uetsid=5c8eb6e0325b11ecaa165167fef53769; _uetvid=5c8ed930325b11ec99170d02a1c524de; s_sq=%5B%5BB%5D%5D; AFFLB=A; SESSID=q1MYVrl_ZvVMUp9FTpfVC_6cJ3.sa-555b95ff76-ddnp9; _abck=4818A14A6F097D98C5669D785DC18DDA~-1~YAAQhtfSF60xUpd8AQAAJlTBogatgx18X1geooWuyWs7XjVVyhSu/f+UarNW5PYzz2BEsH/6xmI4PTsIdFw+p5jUo7TODZ+6HugiQHi9nlKGJSpSZ/Pt8UGdRbNFS8AnV6IaCUhdrsxt2XEQAeb4UiqWUvfe27qN0dXFfbL3hKHWUHEWtOKWxWrmcPv4zx2bcJKMj9XeYlzBLfBY8w1gMNAo6GUsqORPOujmJJ9itSXrMQkuM/SlN7wr1CiLf5y2NIkeuChNnB6terrLkz84wS2Cx1g82KKKICsMRW8btqeMgJcb/5J8yDywN4GhQxinxFwbdIE+t5efgSGPjrIWpgxI2/CVi/AjUvCZ6RDYX6WsQZ7wjaG2LHP1Q4L4Vf4zBHDPXaRSeOCUuEWbzibMqJIUSZPL5UHr~0~-1~-1; asc=1; aws=1; homepage_search_data=5aSn6ZiqLCDlpKfpmKrlupwsIOaXpeacrA..%2F%2F2022-01-04%2F%2F2022-01-05%2F%2F1%2F%2Fyyyy-MM-dd%2F%2F728660%2F%2F; mvthistory=eJwtjDkOwzAMBH9EiPfRpkkTuAmQ0rX%2F4MdHFtUNh7ubAQYDLsaSVPCHozBIJ40JjkCP9MIUW5JGZEsu4uBmLFLLDmjupLEAru88vC1cVEzuKyGIukGlh2Sy8ZY%2Bus8lJLvCA3vHS5SpA7OVsVr3%2B3V8zu%2FvD7ZZLqA%3D; user=QSp6aF9UV3xIQ09NX1RX; visitId=289c99ff-459d-4a35-a937-bc14e700b32f',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36',
    'referer': 'https://tw.hotels.com/search.do?destination-id=728660&q-check-in=2022-01-04&q-check-out=2022-01-05&q-rooms=1&q-room-0-adults=1&q-room-0-children=0&sort-order=BEST_SELLER',
    'Content-Type': 'application/json'
    }

    response = requests.request("POST", url, headers=headers, data=payload)
    result = response.json()
    totalCount= result['data']['searchPage']['id']['body']['searchResults']['totalCount']
    return totalCount

def getHotel(id,value,type,shortName,page,date1,date2):
    url = "https://tw.hotels.com/kes/graphql"

    payload = json.dumps({
    "operationName": "searchPageQuery",
    "variables": {
        "sqmState": {
        "destination": {
            "id": "{}".format(id),
            "value": "{}".format(value),
            "type": "{}".format(type),
            "shortName": "{}".format(shortName)
        },
        "checkIn": "{}".format(date1),
        "checkOut": "{}".format(date2),
        "rooms": 1,
        "adults": {
            "0": 1
        },
        "kids": {
            "0": []
        }
        },
        "filterState": {
        "accessibility": [],
        "accommodationType": [],
        "amenities": [],
        "applied": False,
        "brands": [],
        "facilities": [],
        "guestRating": {
            "min": None,
            "max": None
        },
        "landmarks": [],
        "name": {
            "id": None,
            "value": ""
        },
        "neighbourhood": [],
        "paymentPreference": [],
        "popular": [],
        "price": {
            "min": None,
            "max": None,
            "multiplier": 1,
            "defaultMax": 25000
        },
        "sortLandmarkId": "",
        "sortOrder": "BEST_SELLER",
        "starRating": [],
        "themesAndTypes": [],
        "types": [],
        "vrFilterClicked": False,
        "welcomeRewards": []
        },
        "pageName": "srp",
        "points": False,
        "pagination": {
        "pn": page,
        "pg": 1,
        "startIndex": 0
        }
    },
    "query": "fragment FilterRangeFragment on FilterRange {\n  min {\n    value\n    defaultValue\n    __typename\n  }\n  max {\n    value\n    defaultValue\n    __typename\n  }\n  increments\n  __typename\n}\n\nfragment FilterWithItemsFragment on FilterWithItems {\n  label\n  applied\n  items {\n    label\n    value\n    applied\n    disabled\n    mappedIds\n    requestParameterName\n    filterCategory\n    minValue\n    maxValue\n    __typename\n  }\n  __typename\n}\n\nquery searchPageQuery($sqmState: SqmState!, $filterState: FilterState, $pagination: SearchPaginationState, $pageName: String, $points: Boolean) {\n  searchPage(\n    sqmState: $sqmState\n    pagination: $pagination\n    filterState: $filterState\n    points: $points\n  ) {\n    id\n    page {\n      ...PageFragment\n      __typename\n    }\n    header {\n      ...HeaderFragment\n      __typename\n    }\n    chassis {\n      ...ChassisFragment\n      __typename\n    }\n    body {\n      ... on SrpBodyError {\n        error {\n          message\n          __typename\n        }\n        __typename\n      }\n      ... on SrpBodySuccess {\n        target\n        searchResults {\n          totalCount\n          narrowResultsText\n          travelAdsAvailableOnSortedSearch\n          pagination {\n            currentPage\n            nextPageUrl\n            __typename\n          }\n          algoGeoBulletsTracking\n          results {\n            ...SearchHotelResultFragment\n            __typename\n          }\n          unavailableCount\n          brandMultiPropertyCarouselResult {\n            ...BrandMultiPropertyCarouselResultFragment\n            __typename\n          }\n          __typename\n        }\n        sortResults {\n          defaultSortApplied\n          distanceOptionLandmarkId\n          sortLandmarkId\n          options {\n            label\n            selectedChoiceLabel\n            choices {\n              label\n              value\n              href\n              selected\n              __typename\n            }\n            enhancedChoices {\n              label\n              choices {\n                label\n                id\n                __typename\n              }\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        filters {\n          applied\n          name {\n            disabled\n            item {\n              hotelId\n              value\n              __typename\n            }\n            __typename\n          }\n          popular {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          price {\n            disabled\n            label\n            range {\n              ...FilterRangeFragment\n              __typename\n            }\n            multiplier\n            __typename\n          }\n          guestRating {\n            disabled\n            applied\n            range {\n              ...FilterRangeFragment\n              __typename\n            }\n            __typename\n          }\n          starRating {\n            label\n            applied\n            items {\n              label\n              value\n              applied\n              disabled\n              mappedIds\n              requestParameterName\n              filterCategory\n              minValue\n              maxValue\n              __typename\n            }\n            __typename\n          }\n          paymentPreference {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          welcomeRewards {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          neighbourhood {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          landmarks {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          accommodationType {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          facilities {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          themesAndTypes {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          accessibility {\n            ...FilterWithItemsFragment\n            __typename\n          }\n          __typename\n        }\n        pointOfSale {\n          currency {\n            separators\n            format\n            __typename\n          }\n          __typename\n        }\n        loyalty {\n          ...LoyaltyFragment\n          __typename\n        }\n        miscellaneous {\n          disclaimer\n          fullSccFormat\n          pageViewBeaconUrl\n          showSortDisclaimer\n          interactiveSortDisclaimer\n          sortDisclaimer\n          compressionMessaging {\n            percentage\n            popularityMessage\n            __typename\n          }\n          rewardBanner {\n            autoOpen\n            type\n            punchCard {\n              collectedNights\n              reservedNights\n              freeNights\n              closeToEarn\n              punchCardMessage\n              __typename\n            }\n            __typename\n          }\n          isAutoPopulatedDate\n          ads {\n            es5LibraryUrl\n            adsLoaderUrl\n            adsPositions\n            nativeBrandListingPosition\n            pageId\n            targetingConfig {\n              mc1\n              CMPTST\n              d\n              ssl\n              kid\n              dta\n              ets\n              ete\n              pd\n              __typename\n            }\n            __typename\n          }\n          showMetaOccupancyNotification\n          travelAdvisoryBannerMessaging {\n            title\n            message\n            links {\n              text\n              url\n              __typename\n            }\n            __typename\n          }\n          freeCancellationBannerMessaging {\n            head\n            description\n            __typename\n          }\n          noCreditCardFilterReportable\n          payPalFilterReportable\n          kesAppDownloadMessaging {\n            ...AppDownloadMessagingFragment\n            __typename\n          }\n          __typename\n        }\n        packageRates {\n          message\n          packageRateIcon\n          __typename\n        }\n        alternativeDestinationsModule {\n          ...AlternativeDestinationFragment\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    footer {\n      ...FooterFragment\n      redemptionFee {\n        link {\n          label\n          href\n          rel\n          target\n          __typename\n        }\n        message\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment PageFragment on Page {\n  head {\n    linkedData\n    __typename\n  }\n  __typename\n}\n\nfragment NavigationLinkFragment on NavigationLink {\n  label\n  linkId\n  url\n  icon\n  rel\n  class\n  number\n  children {\n    kes_icon\n    label\n    linkId\n    class\n    url\n    icon\n    rel\n    number\n    __typename\n  }\n  __typename\n}\n\nfragment HeaderFragment on Header {\n  id\n  tracking {\n    consentGiven\n    callCcaOnInit\n    showBanner\n    __typename\n  }\n  pos {\n    label\n    __typename\n  }\n  navigationLinks {\n    top {\n      ...NavigationLinkFragment\n      __typename\n    }\n    topAlt {\n      ...NavigationLinkFragment\n      __typename\n    }\n    bottom {\n      ...NavigationLinkFragment\n      __typename\n    }\n    bottomAlt {\n      ...NavigationLinkFragment\n      __typename\n    }\n    __typename\n  }\n  userPrivacyPreferences {\n    dnsmpi\n    __typename\n  }\n  user {\n    is_identified\n    is_logged_in\n    hcom_rewards_tier\n    channel\n    __typename\n  }\n  newsletterSignUpAnywhere {\n    nativeApplicationDownloadUrl\n    privacyPolicyLink\n    termsAndConditionsLink\n    proxyUrl\n    targetOrigin\n    __typename\n  }\n  config {\n    targetUrl\n    __typename\n  }\n  context {\n    includeCurrencyOption\n    flagIso\n    currencyLabel\n    __typename\n  }\n  cobrand\n  headerConfig {\n    logoPosition\n    orderFlipped\n    sameColors\n    mobileMenuPosition\n    __typename\n  }\n  poweredBy\n  __typename\n}\n\nfragment ChassisFragment on Chassis {\n  id\n  page {\n    pageTitle\n    metas\n    links\n    cdb\n    mdl\n    omniture\n    __typename\n  }\n  user {\n    firstName\n    consent {\n      callCcaOnInit\n      consentGiven\n      showBanner\n      dnsmpi\n      __typename\n    }\n    favourites\n    __typename\n  }\n  tracking {\n    harvesterUrl\n    travelPixelEnv\n    tagCommanderUrl\n    googleTagManagerId\n    omnitureAccount\n    __typename\n  }\n  mainImage {\n    href\n    focus\n    enabled\n    __typename\n  }\n  appContext {\n    pos\n    channel\n    platform\n    currency\n    locale\n    brandId\n    langdir\n    isKnownUser\n    clientId\n    clientVersion\n    authenticationState\n    guid\n    customerId\n    subscriber\n    __typename\n  }\n  srs {\n    suggest\n    resolve\n    recommend\n    commonParams {\n      providerInfoTypes\n      locale\n      __typename\n    }\n    __typename\n  }\n  sqm {\n    destination {\n      id\n      value\n      type\n      resolvedLocation {\n        name\n        latitude\n        longitude\n        __typename\n      }\n      shortName\n      latitude\n      longitude\n      __typename\n    }\n    toSRPdestination {\n      id\n      value\n      type\n      __typename\n    }\n    title\n    checkIn\n    checkOut\n    rooms\n    firstDayOfWeek\n    adults\n    kids\n    isVisible\n    __typename\n  }\n  filter {\n    accessibility\n    accommodationType\n    amenities\n    applied\n    brands\n    facilities\n    guestRating {\n      min\n      max\n      __typename\n    }\n    landmarks\n    name {\n      id\n      value\n      __typename\n    }\n    neighbourhood\n    paymentPreference\n    popular\n    price {\n      min\n      max\n      multiplier\n      defaultMax\n      __typename\n    }\n    sortLandmarkId\n    sortOrder\n    starRating\n    themesAndTypes\n    types\n    vrFilterClicked\n    welcomeRewards\n    __typename\n  }\n  navigation {\n    pathname\n    rateplanId\n    search\n    sbgState {\n      rooms\n      kids\n      adults\n      __typename\n    }\n    points\n    __typename\n  }\n  __typename\n}\n\nfragment FooterFragment on Footer {\n  id(id: $pageName)\n  links {\n    label\n    href\n    children {\n      label\n      href\n      rel\n      target\n      item_meta {\n        id\n        class\n        __typename\n      }\n      __typename\n    }\n    rel\n    target\n    sub_label\n    item_meta {\n      id\n      class\n      __typename\n    }\n    __typename\n  }\n  copyright\n  loyaltyProgramLink {\n    label\n    href\n    rel\n    target\n    __typename\n  }\n  trustMessage\n  legallyCompliantPricesMessage\n  __typename\n}\n\nfragment SearchHotelResultFragment on SearchResult {\n  hotelId\n  imageId\n  hostType\n  addNoFollow\n  searchHotelDetails {\n    ...SearchHotelDetailsFragment\n    __typename\n  }\n  pinned {\n    info\n    reason\n    isStopSell\n    reasonCode\n    __typename\n  }\n  sponsored {\n    impressionTrackingUrl\n    clickTrackingUrl\n    travelAdDetails\n    travelAdDetailsHeadLine\n    travelAdHotelImage\n    __typename\n  }\n  coupon\n  deal {\n    ...DealFragment\n    __typename\n  }\n  neighbourhood\n  geoBullets\n  propertyType\n  popularAmenities {\n    type\n    description\n    __typename\n  }\n  altText\n  ratePlan {\n    price {\n      ...SearchResultRatePlanPriceFragment\n      __typename\n    }\n    features {\n      instalmentsMessage\n      noCCRequired\n      freeCancellation\n      payAtPropertyBadge\n      __typename\n    }\n    __typename\n  }\n  coordinate {\n    lat\n    lon\n    __typename\n  }\n  roomsLeft\n  soldOut\n  dealOfTheDay\n  isInExpandedArea\n  badging {\n    hotelBadge {\n      type\n      label\n      loyaltyTier\n      tooltipTitle\n      tooltipText\n      percentile\n      __typename\n    }\n    secretPriceBadge\n    __typename\n  }\n  couponBadge {\n    badgeName\n    tooltip\n    badgeText\n    linkText\n    linkPath\n    __typename\n  }\n  vip\n  urls {\n    alternativeOccupancy {\n      adults\n      kids\n      __typename\n    }\n    __typename\n  }\n  rlsa\n  isGreatMatch\n  imageTrackingInfo\n  hotelMessage\n  vitality\n  bedTypeOccupancy\n  isVrboProperty\n  __typename\n}\n\nfragment SearchHotelDetailsFragment on SearchHotelDetails {\n  id\n  name\n  vrBadge\n  optimizedThumbUrl\n  optimizedCompactThumbUrl\n  optimizedImages {\n    imageUrl\n    title\n    __typename\n  }\n  address {\n    countryName\n    locality\n    postalCode\n    region\n    streetAddress\n    obfuscate\n    __typename\n  }\n  fullAddress\n  locationCoordinates {\n    latitude\n    longitude\n    __typename\n  }\n  starRating\n  guestReviews {\n    rating\n    lowRating\n    badgeText\n    total\n    __typename\n  }\n  welcomeRewards {\n    tooltipText\n    collect\n    redeem\n    __typename\n  }\n  selectButtonText\n  __typename\n}\n\nfragment SearchResultRatePlanPriceFragment on SearchResultRatePlanPrice {\n  current\n  secondaryFormatted\n  exactCurrent\n  old\n  info\n  summary\n  fromPrice\n  supplierCollectedCharges\n  totalPricePerStay\n  fullyBundledPricePerStay\n  roomCount\n  priceBreakdown {\n    title\n    callToActionLabel\n    includedMeals {\n      label\n      type\n      __typename\n    }\n    lineItems {\n      label\n      feeDetails\n      price\n      __typename\n    }\n    total {\n      label\n      price\n      __typename\n    }\n    additionalFees {\n      label\n      price\n      __typename\n    }\n    totalIncludingAdditionalFees {\n      label\n      price\n      __typename\n    }\n    ecaMessage\n    __typename\n  }\n  __typename\n}\n\nfragment DealFragment on Deal {\n  text\n  type\n  purpose\n  discountPercent\n  translation\n  packageRateIcon\n  __typename\n}\n\nfragment BrandMultiPropertyCarouselResultFragment on BrandMultiPropertyCarouselResult {\n  brandAdCopy\n  brandLogo\n  position\n  title\n  seeAllPropertiesURLText\n  brandIds\n  properties {\n    ...SearchHotelResultFragment\n    __typename\n  }\n  __typename\n}\n\nfragment AlternativeDestinationFragment on AlternativeDestinationList {\n  category\n  key\n  title\n  egRecsResponseData {\n    responseId\n    success\n    __typename\n  }\n  cards {\n    gaiaId\n    destinationId\n    propertyTypeName\n    image {\n      src\n      alt\n      author {\n        name\n        url\n        origin\n        license {\n          suite\n          url\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    title\n    description\n    popUpSqmTitle\n    filters {\n      accommodationType\n      amenities\n      starRating\n      types\n      themesAndTypes\n      __typename\n    }\n    link\n    __typename\n  }\n  __typename\n}\n\nfragment AppDownloadMessagingFragment on KesAppDownloadMessagingModular {\n  downloadAppUrl\n  enabled\n  id\n  category\n  key\n  heading\n  body\n  __typename\n}\n\nfragment LoyaltyFragment on Loyalty {\n  pointsToggle {\n    pointsName\n    enabled\n    infoMessage\n    airMilesChecked\n    __typename\n  }\n  banner {\n    message\n    sidebarMessage\n    __typename\n  }\n  __typename\n}\n"
    })
    headers = {
    'cookie': 'bm_sz=2B1DF69BCA48BC1620711995E65EE276~YAAQbNfSF23mBlR8AQAA9kpwog3nFvZwgsy83GFCQGHCQtH7l5SfETSrdsz+MSiVk0Zoj6lKSATyxlXOHqHAklbTDeoTJqugzaZH9K+MHcFGUW35hTtiJ3y+L6O67o9oAmzDRVRMrA0+Ex6fuAndplIQSBB91oKPcUftm+SbCXMiD/M+F0EUOym0U8mNHqGcS/A8E8GDJqVHgDS1D3OoCHROayD+qJ2/e6xMpVQHlE+u46e1hDT7cuhFmFMo2OTTZPvmbr8J64BzyGcLYKQMmMeEkOjMmcnbSsebc7nt0iax3Z8=~3749173~3224625; aws=1; asc=1; visitId=289c99ff-459d-4a35-a937-bc14e700b32f; SESSID=9fo7pEVg9Ihdbeg4z-vsz08iA7.hpa-5484d594bb-j8k8k; user=QSp6aF9UV3xIQ09NX1RX; guid=44b54c97-755f-4974-ba60-76eae9d5559d; MC1=GUID=44b54c97755f4974ba6076eae9d5559d; DUAID=44b54c97-755f-4974-ba60-76eae9d5559d; mvthistory=eJwtzTEOgDAMQ9EbVUmcNmlWFhbEgsTIzB04PJB2e%2FqyZHaphQoFu3GRj7cFd20ZhbyPiBA4hjmk9jlo0MIZKSBmWZW5TjRMGI0dQkG%2F8kkrZHQN7Z7jZ1327TrOF8SNIQ8%3D; dr=CCC~1634812845~62AB874DF01AE5275749371BE36C0408696F14285765523964F5A31B2EDDA8A8; akacd_pr_20=1639996846~rv=28~id=1984c7207359e5e958fb981f371f092d; _abck=4818A14A6F097D98C5669D785DC18DDA~0~YAAQbNfSF3rmBlR8AQAAXmdwogbQXLqaiW0p3R/NkhxCU3eh0hDv5yL785qlEitqK6jrKWhWpAD+EsykFlZuu0qyCK/8qIOeAW1rrXEEmhiQUN/jpzOy3KBy/3Ngeb3ZX9kV5ehnAjTmKPSiOcDMTlSXQp/SdDyXaL+1x+pSUOWJb0oVaSKCzX5SRsfyqo430RxeIVTfg/EwxxV7SfTJftCblLN04rlFu1EVxc3O6DlK6YM5BbAWMfWjWij6rPaLQS4swocLwWOxqincPAKgz1du0RdpEATn3uRYpeu2AANcBZrHkEh95dmPw6t7c49CpQmvBkU0O1GMuXKNyZYE+N89BBfYQZHGCioDQFDldmvpUm/mUkMRbKz8WWySyIEhlgLWqPkBFftfWuD79Bm+nTjKoBa9yMTD~-1~-1~-1; AMCVS_C00802BE5330A8350A490D4C%40AdobeOrg=1; s_ecid=MCMID%7C34822611654359650602901547180939099068; AMCV_C00802BE5330A8350A490D4C%40AdobeOrg=-1330315163%7CMCIDTS%7C18922%7CMCMID%7C34822611654359650602901547180939099068%7CMCAAMLH-1635417648%7C11%7CMCAAMB-1635417648%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1634820048s%7CNONE%7CMCAID%7CNONE; s_cc=true; xdid=138f2060-8f5b-42fc-b311-695ebaf2531d|1634191302|expedia.com.tw; xdidp=138f2060-8f5b-42fc-b311-695ebaf2531d|1634191302|expedia.com.tw; Session_Pageviews=1; _ga=GA1.2.1890440273.1634812852; _gid=GA1.2.375059388.1634812852; _gat_gtag_UA_32616238_1=1; _gcl_au=1.1.1705634850.1634812852; _uetsid=5c8eb6e0325b11ecaa165167fef53769; _uetvid=5c8ed930325b11ec99170d02a1c524de; s_sq=%5B%5BB%5D%5D; AFFLB=A; SESSID=q1MYVrl_ZvVMUp9FTpfVC_6cJ3.sa-555b95ff76-ddnp9; _abck=4818A14A6F097D98C5669D785DC18DDA~-1~YAAQhtfSF60xUpd8AQAAJlTBogatgx18X1geooWuyWs7XjVVyhSu/f+UarNW5PYzz2BEsH/6xmI4PTsIdFw+p5jUo7TODZ+6HugiQHi9nlKGJSpSZ/Pt8UGdRbNFS8AnV6IaCUhdrsxt2XEQAeb4UiqWUvfe27qN0dXFfbL3hKHWUHEWtOKWxWrmcPv4zx2bcJKMj9XeYlzBLfBY8w1gMNAo6GUsqORPOujmJJ9itSXrMQkuM/SlN7wr1CiLf5y2NIkeuChNnB6terrLkz84wS2Cx1g82KKKICsMRW8btqeMgJcb/5J8yDywN4GhQxinxFwbdIE+t5efgSGPjrIWpgxI2/CVi/AjUvCZ6RDYX6WsQZ7wjaG2LHP1Q4L4Vf4zBHDPXaRSeOCUuEWbzibMqJIUSZPL5UHr~0~-1~-1; asc=1; aws=1; homepage_search_data=5aSn6ZiqLCDlpKfpmKrlupwsIOaXpeacrA..%2F%2F2022-01-04%2F%2F2022-01-05%2F%2F1%2F%2Fyyyy-MM-dd%2F%2F728660%2F%2F; mvthistory=eJwtjDkOwzAMBH9EiPfRpkkTuAmQ0rX%2F4MdHFtUNh7ubAQYDLsaSVPCHozBIJ40JjkCP9MIUW5JGZEsu4uBmLFLLDmjupLEAru88vC1cVEzuKyGIukGlh2Sy8ZY%2Bus8lJLvCA3vHS5SpA7OVsVr3%2B3V8zu%2FvD7ZZLqA%3D; user=QSp6aF9UV3xIQ09NX1RX; visitId=289c99ff-459d-4a35-a937-bc14e700b32f',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36',
    'referer': 'https://tw.hotels.com/search.do?destination-id=728660&q-check-in=2022-01-04&q-check-out=2022-01-05&q-rooms=1&q-room-0-adults=1&q-room-0-children=0&sort-order=BEST_SELLER',
    'Content-Type': 'application/json'
    }

    response = requests.request("POST", url, headers=headers, data=payload)
    result = response.json()
    result['data']['searchPage']['id']
    print(result)
# def getHotel(id,value,type,shortName,page,num,date1,date2):
def getJPhotelSigleTh(date):
    next1 = date + timedelta(days=1)
    a = next1.strftime("%Y-%m-%d")
    b = date.strftime("%Y-%m-%d")
    for items in param.locHotelCOM:
        totalCount = gettotalHotel(param.locHotelCOM[items][0],param.locHotelCOM[items][1],param.locHotelCOM[items][2],param.locHotelCOM[items][3],1,0,b,a)
        
        getHotel(param.locHotelCOM[items][0],param.locHotelCOM[items][1],param.locHotelCOM[items][2],param.locHotelCOM[items][3],1,0,b,a)
        time.sleep(1)
    print('------finish-------'+date)

for i in range(1,19):
    start_date = date.today()+timedelta(5*(i-1))
    end_date = date.today()+ timedelta(5*i)
    datelist = [ single_date for single_date in daterange(start_date, end_date)]
    
        
    start_time = time.time()
    with concurrent.futures.ThreadPoolExecutor(max_workers=3) as executor:
        
        executor.map(getJPhotelSigleTh, datelist)

    end_time = time.time()
    print(f"{end_time - start_time} 秒爬取")
    time.sleep(600)

# def getHotel(id,value,type,shortName,page,num):


